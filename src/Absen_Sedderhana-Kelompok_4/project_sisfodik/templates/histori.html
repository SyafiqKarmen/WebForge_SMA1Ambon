{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Histori Kehadiran</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Poly&display=swap" rel="stylesheet">

    <style>
        body { font-family: "Poppins", sans-serif; }

        .day-cell {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin: 2px;
        }

        .status-hadir { background: #30a14e; }
        .status-izin { background: #3b82f6; }
        .status-tidak { background: #dc2626; }
        .status-today { background: #f97316; }
        .status-none { background: #4b5563; }

        /* MONTH BOX NOW WHITE */
        .month-box {
            background: #243a73;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
    </style>
</head>

<body class="bg-[linear-gradient(180deg,rgba(155,27,48,1)_0%,rgba(160,0,0,1)_100%)] min-h-screen w-full relative">

<!-- SIDEBAR -->
<div class="absolute top-0 left-0 w-72 h-full bg-[#243a73] flex flex-col items-center py-8">
    <h2 class="text-white text-xl font-bold mb-12">HISTORI KEHADIRAN</h2>

    <div class="w-[95%] ml-4">
        <a href="{% url 'dashboard' %}" class="block bg-[#243A73] rounded-l-full px-4 py-2 mb-4 flex items-center gap-2 text-[#FFEA00] hover:opacity-80">
            <img src="{% static 'img/ABSEN.png' %}" class="w-4 h-4"> ABSEN
        </a>
        <a href="{% url 'histori' %}" class="block bg-[#9b1b30] rounded-l-full px-4 py-2 mb-4 flex items-center gap-2 text-white hover:opacity-80">
            <img src="{% static 'img/HISTORI.png' %}" class="w-4 h-4"> HISTORI
        </a>
        <a href="{% url 'logout' %}" class="block bg-[#243A73] rounded-l-full px-4 py-2 mb-4 flex items-center gap-2 text-[#FFEA00] hover:opacity-80">
            <img src="{% static 'img/LOGOUT.png' %}" class="w-4 h-4 rotate-180"> LOGOUT
        </a>
    </div>

    <div class="mt-auto text-white text-base font-normal pr-20">
        <p>USERNAME : {{ username }}</p>
        <p>KELAS : {{ kelas }}</p>
        <p>LOKASI : {{ lokasi }}</p>
        <p class="inline mt-4">SMAN 1 AMBON</p>
        <img src="{% static 'img/SMANSA.png' %}" class="inline w-5 h-5">
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="ml-72 p-10 w-[calc(100%-18rem)]">

    <h1 class="text-white text-xl mb-6 font-normal [font-family:'Poly-Regular']">HISTORI KEHADIRAN 2025</h1>

    <!-- MONTH GRID -->
    <div id="monthGrid" class="grid grid-cols-3 gap-6"></div>

</div>

<script>
const monthNames = [
    "JANUARI","FEBRUARI","MARET","APRIL",
    "MEI","JUNI","JULI","AGUSTUS",
    "SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"
];

function generateDays(year, month) {
    const date = new Date(year, month, 1);
    const days = [];
    while (date.getMonth() === month) {
        days.push(date.toISOString().split("T")[0]);
        date.setDate(date.getDate() + 1);
    }
    return days;
}

function buildHistory() {
    const grid = document.getElementById("monthGrid");
    const year = 2025;
    const today = new Date().toISOString().split("T")[0];

    for (let m = 0; m < 12; m++) {
        const days = generateDays(year, m);

        const box = document.createElement("div");
        box.className = "month-box";

        const title = document.createElement("h2");
        title.className = "text-black text-lg mb-3 font-semibold";
        title.innerText = monthNames[m];
        box.appendChild(title);

        const dayContainer = document.createElement("div");
        dayContainer.className = "flex flex-wrap";

        days.forEach(date => {
            const key = "absen_" + date;
            const val = localStorage.getItem(key);

            let colorClass = "status-none";

            if (date === today) {
                colorClass = "status-today";
            } else if (val === "hadir") {
                colorClass = "status-hadir";
            } else if (val === "izin") {
                colorClass = "status-izin";
            } else if (val === "tidak-hadir") {
                colorClass = "status-tidak";
            }

            const cell = document.createElement("div");
            cell.className = "day-cell " + colorClass;
            cell.title = date + " : " + (val ?? "no data");

            dayContainer.appendChild(cell);
        });

        box.appendChild(dayContainer);
        grid.appendChild(box);
    }
}

document.addEventListener("DOMContentLoaded", buildHistory);
</script>

</body>
</html>
